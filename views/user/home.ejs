<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="ZAPZONE - Your Ultimate Laptop Destination">
    <meta name="keywords" content="laptops, gaming laptops, office laptops, tech">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>ZAPZONE - Your Ultimate Laptop Destination</title>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">

    <!-- CSS Files -->
    <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="css/elegant-icons.css" type="text/css">
    <link rel="stylesheet" href="css/magnific-popup.css" type="text/css">
    <link rel="stylesheet" href="css/nice-select.css" type="text/css">
    <link rel="stylesheet" href="css/owl.carousel.min.css" type="text/css">
    <link rel="stylesheet" href="css/slicknav.min.css" type="text/css">
    <link rel="stylesheet" href="css/style.css" type="text/css">

    <style>
        /* Main Styles */
        body {
            font-family: 'Nunito Sans', sans-serif;
            color: #333;
            background-color: #f8f9fa;
        }

        /* Preloader */
        #preloder {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 999999;
            background: #ffffff;
        }
        .loader {
            width: 40px;
            height: 40px;
            position: absolute;
            top: 50%;
            left: 50%;
            margin-top: -20px;
            margin-left: -20px;
            border: 2px solid #212936;
            border-top: 2px solid #0099cc;
            border-radius: 50%;
            animation: loader-spin 1s linear infinite;
        }
        @keyframes loader-spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Hero Section */
        .hero {
            position: relative;
            overflow: hidden;
        }
        .hero__items {
            height: 70vh;
            min-height: 500px;
            display: flex;
            align-items: center;
            position: relative;
            z-index: 1;
        }
        .hero__text {
            padding: 82px;
            max-width: 478px;
            background-color: rgba(0, 0, 0, 0.6);
            border-radius: 8px;
        }
        .hero__text h6 {
            color: #0099cc;
            font-weight: 600;
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        .hero__text h2 {
            color: white;
            font-weight: 700;
            margin-bottom: 20px;
            font-size: 32px;
            line-height: 1.2;
        }
        .hero__text p {
            color: #e0e0e0;
            margin-bottom: 25px;
        }
        .primary-btn {
            display: inline-block;
            padding: 10px 25px;
            background-color: #0099cc;
            color: white;
            font-weight: 600;
            border-radius: 4px;
            text-decoration: none;
            transition: all 0.3s;
        }
        .primary-btn:hover {
            background-color: #007baa;
            color: white;
            text-decoration: none;
        }
        .hero__social {
            margin-top: 20px;
        }
        .hero__social a {
            display: inline-block;
            width: 35px;
            height: 35px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            color: white;
            line-height: 35px;
            text-align: center;
            margin-right: 10px;
            transition: all 0.3s;
        }
        .hero__social a:hover {
            background-color: #0099cc;
        }

        /* Banner Section */
        .banner {
            padding: 40px 0;
        }
        .banner__item {
            position: relative;
            overflow: hidden;
            border-radius: 8px;
            margin-bottom: 30px;
            height: 300px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        .banner__item__pic {
            height: 100%;
            width: 100%;
            position: relative;
        }
        .banner__item__pic img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .banner__item__text {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 25px;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
        }
        .banner__item__text h2 {
            color: white;
            font-weight: 700;
            margin-bottom: 0;
        }
        .banner__item__text a {
            display: inline-block;
            color: white;
            background-color: #0099cc;
            padding: 5px 15px;
            border-radius: 3px;
            margin-top: 10px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s;
        }
        .banner__item__text a:hover {
            background-color: #007baa;
        }

        /* Product Section */
        .product {
            padding: 50px 0;
        }
        .product .section-title {
            text-align: center;
            margin-bottom: 40px;
        }
        .filter__controls {
            text-align: center;
            margin-bottom: 40px;
        }
        .new {
            font-size: 32px;
            font-weight: 700;
            margin: 0 auto;
            position: relative;
            display: inline-block;
            color: #212936;
        }
        .new:after {
            content: "";
            position: absolute;
            bottom: -10px;
            left: 50%;
            width: 50px;
            height: 3px;
            background-color: #0099cc;
            transform: translateX(-50%);
        }

        /* Product Card Styles */
        .product-item {
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            background-color: #fff;
            transition: all 0.3s;
            margin-bottom: 30px;
            overflow: hidden;
        }
        .product-item:hover {
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            transform: translateY(-5px);
        }
        .product-img-wrap {
            position: relative;
            padding: 20px;
            background-color: #f8f8f8;
            text-align: center;
            height: 220px;
        }
        .product-img-wrap img {
            max-width: 100%;
            max-height: 180px;
            object-fit: contain;
        }
        .wishlist-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 2;
        }
        .wishlist-btn a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 35px;
            height: 35px;
            background-color: white;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
            color: #e5e5e5;
            transition: all 0.3s;
        }
        .wishlist-btn a.in-wishlist {
            color: #e74c3c;
        }
        .wishlist-btn a:hover {
            transform: scale(1.1);
            color: #c0392b;
        }
        .wishlist-btn a.disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .offer-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            z-index: 2;
        }
        .offer-badge span {
            display: inline-block;
            padding: 5px 10px;
            background-color: #e74c3c;
            color: white;
            font-size: 12px;
            font-weight: 600;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
            transition: all 0.3s;
        }
        .offer-badge span:hover {
            background-color: #c0392b;
        }
        .product-details {
            padding: 15px;
        }
        .product-details h6 {
            font-size: 16px;
            margin-bottom: 10px;
            color: #333;
            font-weight: 600;
            height: 40px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-box-orient: vertical;
        }
        .price-box {
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 15px;
            color: #212936;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .price-box.out-of-stock {
            color: #e74c3c;
            font-weight: bold;
        }
        .original-price {
            text-decoration: line-through;
            color: #999;
            font-size: 16px;
        }
        .offer-price {
            color: #e74c3c;
            font-size: 18px;
            font-weight: 700;
        }
        .cart-btn {
            display: block;
            width: 100%;
            padding: 10px 0;
            background-color: #212936;
            color: white;
            text-align: center;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
            text-decoration: none;
            transition: background-color 0.3s;
            border: none;
            cursor: pointer;
        }
        .cart-btn:hover {
            background-color: #0099cc;
            color: white;
            text-decoration: none;
        }
        .cart-btn.disabled {
            background-color: #ccc;
            cursor: not-allowed;
            pointer-events: none;
            color: #666;
        }

        /* Loading Animation */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #e74c3c;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Notification Styles */
        .zz-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #28a745;
            color: white;
            padding: 15px 20px;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 2000;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            max-width: 300px;
            animation: slideIn 0.3s ease-in-out;
        }
        .zz-notification.error {
            background-color: #e74c3c;
        }
        .zz-notification.show {
            display: block;
        }
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* Responsive Styles */
        @media (max-width: 991px) {
            .hero__items {
                height: 60vh;
                min-height: 400px;
            }
            .hero__text h2 {
                font-size: 28px;
            }
            .banner__item {
                height: 250px;
            }
        }
        @media (max-width: 767px) {
            .hero__items {
                height: 50vh;
                min-height: 350px;
            }
            .hero__text {
                max-width: 100%;
                padding: 20px;
            }
            .hero__text h2 {
                font-size: 24px;
            }
            .hero__text h6 {
                font-size: 14px;
            }
            .new {
                font-size: 28px;
            }
            .banner__item__text h2 {
                font-size: 22px;
            }
        }
        @media (max-width: 575px) {
            .hero__items {
                min-height: 300px;
            }
            .hero__text h2 {
                font-size: 20px;
            }
            .banner__item {
                height: 200px;
            }
            .product-img-wrap {
                height: 180px;
            }
            .product-img-wrap img {
                max-height: 140px;
            }
        }
    </style>
</head>

<body>
    <!-- Header section from partials -->
    <%- include("../partials/user/header") %>
   
    <!-- Preloader -->
    <div id="preloder">
        <div class="loader"></div>
    </div>

    <!-- Offcanvas Menu (Mobile) -->
    <div class="offcanvas-menu-overlay"></div>
    <div class="offcanvas-menu-wrapper">
        <div class="offcanvas__option">
            <div class="offcanvas__links">
                <a href="/login">Sign in</a>
                <a href="/signup">Sign up</a>
                <a href="/faq">FAQs</a>
            </div>
        </div>
        <div class="offcanvas__nav__option">
            <a href="#" class="search-switch"><img src="img/icon/search.png" alt=""></a>
            <a href="/wishlist"><img class="imgg" src="img/icon/heart.png" alt=""></a>
            <a href="/cart"><img src="img/icon/cart.png" alt=""></a>
        </div>
        <div id="mobile-menu-wrap"></div>
        <div class="offcanvas__text">
            <p>Free shipping, 30-day return or refund guarantee.</p>
        </div>
    </div>
    
    <!-- Hero Section -->
    <section class="hero">
        <div class="hero__slider owl-carousel">
            <div class="hero__items set-bg" data-setbg="img/hero/first.jpg">
                <div class="container">
                    <div class="row">
                        <div class="col-xl-5 col-lg-7 col-md-8">
                            <div class="hero__text">
                                <h6>Up to 100% Off – Limited Time!</h6>
                                <h2>Your One-Stop Shop for Premium Laptops</h2>
                                <p>Discover your new world and enjoy happy moments with our latest high-performance laptops</p>
                                <a href="/shop" class="primary-btn">Shop now <span class="arrow_right"></span></a>
                                <div class="hero__social">
                                    <a href="#"><i class="fa fa-facebook"></i></a>
                                    <a href="#"><i class="fa fa-twitter"></i></a>
                                    <a href="#"><i class="fa fa-instagram"></i></a>
                                    <a href="#"><i class="fa fa-linkedin"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="hero__items set-bg" data-setbg="img/hero/sec.jpg">
                <div class="container">
                    <div class="row">
                        <div class="col-xl-5 col-lg-7 col-md-8">
                            <div class="hero__text">
                                <h6>Unbeatable Discounts – Don't Miss Out!</h6>
                                <h2>Power Up Your Productivity – Find Your Perfect Laptop Today!</h2>
                                <p>Explore New Possibilities and Elevate Your Experience with our cutting-edge devices</p>
                                <a href="/shop" class="primary-btn">Shop now <span class="arrow_right"></span></a>
                                <div class="hero__social">
                                    <a href="#"><i class="fa fa-facebook"></i></a>
                                    <a href="#"><i class="fa fa-twitter"></i></a>
                                    <a href="#"><i class="fa fa-instagram"></i></a>
                                    <a href="#"><i class="fa fa-linkedin"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Banner Section -->
    <section class="banner">
        <div class="container">
            <div class="row">
                <div class="col-lg-5 col-md-6">
                    <div class="banner__item">
                        <div class="banner__item__pic">
                            <img src="img/banner/photo-1527689368864-3a821dbccc34.avif" alt="Office Laptops">
                        </div>
                        <div class="banner__item__text">
                            <h2>Office Laptops</h2>
                            <a href="/shop?category=office">Shop Now</a>
                        </div>
                    </div>
                </div>
                <div class="col-lg-7 col-md-6">
                    <div class="banner__item">
                        <div class="banner__item__pic">
                            <img src="img/banner/3kcgKLkfPRbskpsYzW239d-1200-80.jpg" alt="Gaming Laptops">
                        </div>
                        <div class="banner__item__text">
                            <h2>Gaming Laptops</h2>
                            <a href="/shop?category=gaming">Shop Now</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
  
    <!-- Product Section -->
    <section class="product">
        <div class="container position-relative">
            <div class="loading-overlay" id="loadingOverlay">
                <div class="loading-spinner"></div>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <div class="filter__controls">
                        <h2 class="new">New Arrivals</h2>
                    </div>
                </div>
            </div>
            <div class="row product__filter">
                <% for(let i = 0; i < products.length; i++) { %>
                <div class="col-lg-3 col-md-4 col-sm-6 col-12">
                    <div class="product-item">
                        <div class="product-img-wrap">
                            <a href="/productDetails?id=<%= products[i]._id %>">
                                <img src="/Uploads/product-images/<%= products[i].productImage[0] %>" alt="<%= products[i].productName %>">
                            </a>
                            <div class="wishlist-btn">
                                <a href="#" class="wishlist-toggle" data-product-id="<%= products[i]._id %>">
                                    <i class="fa fa-heart"></i>
                                </a>
                            </div>
                            <% if (products[i].hasOffer && products[i].offerPercentage > 0) { %>
                                <div class="offer-badge">
                                    <span><%= products[i].offerPercentage %>% OFF</span>
                                </div>
                            <% } %>
                        </div>
                        <div class="product-details">
                            <h6><%= products[i].productName %></h6>
                            <div class="price-box <%= products[i].quantity === 0 ? 'out-of-stock' : '' %>">
                                <% if (products[i].quantity > 0) { %>
                                    <% if (products[i].hasOffer && products[i].offerPrice !== null) { %>
                                        <span class="original-price">₹ <%= products[i].salePrice.toLocaleString('en-IN') %></span>
                                        <span class="offer-price">₹ <%= products[i].offerPrice.toLocaleString('en-IN') %></span>
                                    <% } else { %>
                                        ₹ <%= products[i].salePrice.toLocaleString('en-IN') %>
                                    <% } %>
                                <% } else { %>
                                    Out of Stock
                                <% } %>
                            </div>
                            <button class="cart-btn <%= products[i].quantity === 0 ? 'disabled' : '' %>" 
                                    data-product-id="<%= products[i]._id %>" 
                                    data-offer-price="<%= products[i].hasOffer ? products[i].offerPrice : products[i].salePrice %>"
                                    <%= products[i].quantity === 0 ? 'disabled' : '' %>>
                                <%= products[i].quantity > 0 ? 'ADD TO CART' : 'OUT OF STOCK' %>
                            </button>
                        </div>
                    </div>
                </div>
                <% } %>
            </div>
        </div>
    </section>
   
    <!-- Search Model -->
    <div class="search-model">
        <div class="h-100 d-flex align-items-center justify-content-center">
            <div class="search-close-switch">+</div>
            <form class="search-model-form">
                <input type="text" id="search-input" placeholder="Search here.....">
            </form>
        </div>
    </div>

    <!-- Notification Container -->
    <div class="zz-notification" id="notification" style="display: none;">
        <span id="notificationMessage"></span>
    </div>

    <!-- Footer section from partials -->
    <%- include("../partials/user/footer") %>

    <!-- Js Plugins -->
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.nice-select.min.js"></script>
    <script src="js/jquery.nicescroll.min.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/jquery.countdown.min.js"></script>
    <script src="js/jquery.slicknav.js"></script>
    <script src="js/mixitup.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/main.js"></script>
    <script>
        $(document).ready(function() {
            // Function to show notification
            function showNotification(message, type = 'success') {
                const notification = $('#notification');
                const notificationMessage = $('#notificationMessage');
                
                notificationMessage.text(message);
                notification.removeClass().addClass(`zz-notification ${type} show`);
                notification.show();
                
                setTimeout(() => {
                    notification.css('animation', 'slideOut 0.3s ease-in-out');
                    setTimeout(() => {
                        notification.hide().css('animation', 'slideIn 0.3s ease-in-out');
                        notification.removeClass('show');
                    }, 300);
                }, 2000);
            }

            // Function to check wishlist status for all products
            function checkWishlistStatus() {
                const productIds = $('.wishlist-toggle').map(function() {
                    return $(this).data('product-id');
                }).get();

                if (productIds.length === 0) return;

                $.ajax({
                    url: '/checkWishlistStatus',
                    method: 'POST',
                    data: {
                        productIds: productIds
                    },
                    success: function(response) {
                        if (response.success) {
                            response.wishlist.forEach(function(item) {
                                const productId = item.productId;
                                const inWishlist = item.inWishlist;
                                const $wishlistBtn = $(`.wishlist-toggle[data-product-id="${productId}"]`);
                                if (inWishlist) {
                                    $wishlistBtn.addClass('in-wishlist');
                                } else {
                                    $wishlistBtn.removeClass('in-wishlist');
                                }
                            });
                        } else {
                            console.error('Error checking wishlist status:', response.message);
                        }
                    },
                    error: function(xhr) {
                        console.error('AJAX Error checking wishlist status:', xhr.status, xhr.responseText);
                    }
                });
            }

            // Handle wishlist toggle
            $('.wishlist-toggle').on('click', function(e) {
                e.preventDefault();
                const $this = $(this);
                if ($this.hasClass('disabled')) return;
                $this.addClass('disabled');
                const productId = $this.data('product-id');
                const isInWishlist = $this.hasClass('in-wishlist');
                const url = isInWishlist ? '/removeFromWishlist' : '/addToWishlist';

                $.ajax({
                    url: url,
                    method: 'POST',
                    data: {
                        productId: productId
                    },
                    success: function(response) {
                        $this.removeClass('disabled');
                        if (response.success) {
                            if (isInWishlist) {
                                $this.removeClass('in-wishlist');
                                showNotification('Removed from your wishlist!', 'success');
                            } else {
                                $this.addClass('in-wishlist');
                                showNotification('Added to your wishlist!', 'success');
                            }
                        } else {
                            showNotification(response.message || 'Could not update wishlist.', 'error');
                        }
                    },
                    error: function(xhr) {
                        $this.removeClass('disabled');
                        if (xhr.status === 401) {
                            showNotification('Please log in to manage your wishlist.', 'error');
                            setTimeout(() => { window.location.href = '/login'; }, 1000);
                        } else {
                            showNotification('Something went wrong with wishlist!', 'error');
                            console.error('Wishlist AJAX Error:', {
                                status: xhr.status,
                                response: xhr.responseText,
                                productId: productId
                            });
                        }
                    }
                });
            });

            // Handle add to cart
            function attachCartButtonListeners() {
                const cartButtons = $('.cart-btn:not(.disabled)');
                cartButtons.on('click', function(e) {
                    e.preventDefault();
                    const $this = $(this);
                    if ($this.hasClass('disabled')) return;
                    $this.prop('disabled', true);
                    const productId = $this.data('product-id');
                    const offerPrice = $this.data('offer-price');
                    const quantity = 1;

                    // Log request data for debugging
                    console.log('Sending addToCart request:', {
                        productId: productId,
                        quantity: quantity,
                        offerPrice: offerPrice
                    });

                    $('#loadingOverlay').show();

                    $.ajax({
                        url: '/addToCart',
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify({
                            productId: productId,
                            quantity: quantity,
                            offerPrice: offerPrice,
                            offerId: null, // Add offerId if needed from appliedOffer
                            flag: false
                        }),
                        success: function(response) {
                            $this.prop('disabled', false);
                            $('#loadingOverlay').hide();
                            console.log('addToCart response:', response);
                            if (response.success) {
                                showNotification('Product added to cart!', 'success');
                            } else {
                                showNotification(response.message || 'Could not add to cart. Please Log in.', 'error');
                            }
                        },
                        error: function(xhr) {
                            $this.prop('disabled', false);
                            $('#loadingOverlay').hide();
                            let errorMessage = 'Something went wrong while adding to cart!';
                            try {
                                const response = JSON.parse(xhr.responseText);
                                errorMessage = response.message || errorMessage;
                            } catch (e) {
                                // Non-JSON response
                            }
                            console.error('addToCart AJAX Error:', {
                                status: xhr.status,
                                response: xhr.responseText,
                                productId: productId,
                                quantity: quantity,
                                offerPrice: offerPrice
                            });
                            if (xhr.status === 401) {
                                showNotification('Please log in to add items to your cart.', 'error');
                                setTimeout(() => { window.location.href = '/login'; }, 1000);
                            } else {
                                showNotification(errorMessage, 'error');
                            }
                        }
                    });
                });
            }

            // Initialize wishlist status and cart buttons on page load
            checkWishlistStatus();
            attachCartButtonListeners();
        });
    </script>
</body>
</html>